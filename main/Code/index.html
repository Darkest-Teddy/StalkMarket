<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>STALK Market - Plant-Based Stock Market Simulator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&family=Press+Start+2P&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css">
</head>
<body class="pixel-bg min-h-screen pixelify">

  <!-- Intro / Disclaimer Overlay -->
  <div id="intro-overlay" class="fixed inset-0 bg-white z-50 flex items-center justify-center px-4 py-8 transition-opacity duration-500">
    <div class="max-w-2xl w-full bg-white border border-emerald-200 shadow-xl rounded-2xl p-8 space-y-6">
      <div class="flex flex-col items-center text-center space-y-3">
        
        <h1 class="text-3xl sm:text-4xl pixel-logo select-none">STALK MARKET</h1>
      </div>
      <div class="space-y-4 text-sm text-gray-700">
        <p class="font-semibold">Disclaimer: This simulator is for educational purposes only. No real money is involved.</p>
        <p>
          Welcome to the STALK Market educational simulator. Prices, macro context, and outcomes in this experience are entirely fictional and crafted for learning. Nothing here should be treated as investment advice or as guidance for real-world trades.
        </p>
        <p>
          Toggle Educational Mode to decide whether the portfolio concentration pressure is enabled. In Educational Mode, the market will not penalize concentrated bets; switch it off to feel how diversification shapes outcomes.
        </p>
      </div>
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <button id="edu-mode-button" class="flex-1 bg-gray-200 text-gray-800 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 transition">
          Educational Mode: OFF
        </button>
        <button id="start-button" class="flex-1 bg-emerald-600 text-white px-4 py-3 rounded-lg font-semibold hover:bg-emerald-700 transition">
          Launch Market
        </button>
      </div>
      <p class="text-xs text-gray-500 text-center">
        Educational Mode turns on the effect of your portfolio diversification on the behavior of the market.
      </p>
      <p class="text-xs text-gray-500 text-center">
        Press “Launch Market” to begin. You acknowledge that all scenarios are simulated and for educational use only.
      </p>
    </div>
  </div>
  <!-- Header -->
  <header class="sticky top-0 z-50 pixel-header">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="logo-banner">
            <h1 class="text-3xl sm:text-4xl pixel-logo select-none">STALK MARKET</h1>
          </div>
        </div>
        <div class="flex items-center space-x-6">
          <div class="text-right">
            <p class="text-sm text-white">Available Cash</p>
            <p class="text-xl font-mono font-semibold text-white" id="header-cash">$10,000.00</p>
          </div>
          <div class="text-right">
            <p class="text-sm text-white">Portfolio Value</p>
            <p class="text-xl font-mono font-semibold text-white" id="header-portfolio-value">$10,000.00</p>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div id="pixel-landscape" aria-hidden="true">
    <svg viewBox="0 0 1200 220" preserveAspectRatio="none" shape-rendering="crispEdges" xmlns="http://www.w3.org/2000/svg">
      <rect x="0" y="120" width="1200" height="100" fill="#167a43"/>
      <rect x="0" y="130" width="1200" height="100" fill="#0f6a38"/>
      <g fill="#0a2f1d" transform="translate(8,8)">
        <rect x="120" y="110" width="120" height="40"/>
        <rect x="240" y="95" width="16" height="55"/>
        <rect x="260" y="95" width="16" height="55"/>
        <rect x="280" y="95" width="16" height="55"/>
        <rect x="300" y="95" width="16" height="55"/>
        <rect x="480" y="85" width="140" height="65"/>
        <rect x="520" y="65" width="60" height="20"/>
        <rect x="740" y="100" width="100" height="50"/>
        <polygon points="760,100 790,70 820,100"/>
        <rect x="920" y="100" width="18" height="50"/>
        <rect x="950" y="100" width="18" height="50"/>
        <rect x="980" y="100" width="18" height="50"/>
      </g>
      <g fill="#134e32">
        <rect x="120" y="110" width="120" height="40"/>
        <rect x="240" y="95" width="16" height="55"/>
        <rect x="260" y="95" width="16" height="55"/>
        <rect x="280" y="95" width="16" height="55"/>
        <rect x="300" y="95" width="16" height="55"/>
        <rect x="480" y="85" width="140" height="65"/>
        <rect x="520" y="65" width="60" height="20"/>
        <rect x="740" y="100" width="100" height="50"/>
        <polygon points="760,100 790,70 820,100"/>
        <rect x="920" y="100" width="18" height="50"/>
        <rect x="950" y="100" width="18" height="50"/>
        <rect x="980" y="100" width="18" height="50"/>
      </g>
    </svg>
  </div>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Top KPIs: Total Value + Cash Available -->
    <section class="mb-4">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <div class="bg-white p-8 shadow-sm border border-gray-200 wood-panel pixel-panel">
          <p class="text-lg mb-2">Total Value</p>
          <p class="text-4xl font-mono font-semibold" id="stat-total-value">$10,000.00</p>
        </div>
        <div class="bg-white p-8 shadow-sm border border-gray-200 wood-panel pixel-panel">
          <p class="text-lg mb-2">Cash Available</p>
          <p class="text-4xl font-mono font-semibold" id="stat-cash">$10,000.00</p>
        </div>
      </div>
    </section>
    <!-- Macro Card + Season Controls -->
    <section class="mb-4">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200 wood-panel pixel-panel">
          <h3 class="text-xl font-display font-semibold mb-2 beige-text">Macro Weather (FRED)</h3>
          <div id="macro-card" class="text-sm text-gray-700 space-y-1">
            <p>Loading macro…</p>
          </div>
        </div>
        <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200 wood-panel pixel-panel">
          <h3 class="text-xl font-display font-semibold mb-2 beige-text">Season Controls</h3>
          <div class="space-y-2">
            <div class="flex items-center space-x-3">
              <button id="btn-new-season" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">Start New Season</button>
              <button id="btn-report" class="bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700">View Report</button>
            </div>
            <div class="flex items-center space-x-3">
              <button id="btn-toggle-clock" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">Pause Clock</button>
              <button id="btn-step" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300">Advance 1 Day</button>
            </div>
            <p class="text-xs text-gray-500">Season ID: <span id="season-id" class="font-mono">—</span></p>
          </div>
        </div>
      </div>
    </section>

    <!-- Stats Grid -->
    <section class="mb-4">
      <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
        <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200 wood-panel pixel-panel">
          <p class="text-sm text-gray-500 mb-1">Plants Owned</p>
          <p class="text-2xl font-mono font-semibold text-gray-900" id="stat-plants-owned">0</p>
        </div>
        <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200 wood-panel pixel-panel">
          <p class="text-sm text-gray-500 mb-1">Today's Growth</p>
          <p class="text-2xl font-mono font-semibold" id="stat-today-growth">+$0.00</p>
        </div>
        <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200 wood-panel pixel-panel">
          <p class="text-sm text-gray-500 mb-1">Market Day</p>
          <p class="text-2xl font-mono font-semibold text-gray-900" id="stat-current-step">Day —</p>
          <p class="text-xs text-gray-500" id="stat-clock-status">Paused</p>
        </div>
      </div>
    </section>

    <!-- Market Section -->
    <section class="mb-12">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-2xl font-display font-semibold text-gray-900 section-heading">Market Garden</h3>
        <button id="btn-mc" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">Peek Risk (Monte Carlo)</button>
      </div>
      <div id="plant-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </section>

    <!-- Garden Simulation -->
    <section class="mb-12">
      <h3 class="text-2xl font-display font-semibold text-gray-900 mb-6 section-heading">Interactive Garden</h3>
      <div id="garden-grid" class="garden-grid"></div>
    </section>

    <!-- Shorted Seeds Section -->
    <section class="mb-12">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-2xl font-display font-semibold text-gray-900 section-heading">Shorted Seeds</h3>
      </div>
      <div id="short-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </section>

    <!-- Transactions Section -->
    <section>
      <h3 class="text-2xl font-display font-semibold text-gray-900 mb-6 section-heading">Recent Activity</h3>
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden wood-panel pixel-panel">
        <div id="transactions-list">
          <div class="p-8 text-center text-gray-500">
            <p>No transactions yet.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Trade Modal -->
  <div id="trade-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 modal-backdrop">
    <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="p-6">
        <div class="flex justify-between items-start mb-6">
          <div>
            <h3 class="text-2xl font-display font-semibold" id="modal-plant-name">Plant Name</h3>
            <p class="text-sm text-gray-500" id="modal-plant-id">plant-id</p>
          </div>
          <button onclick="closeTradeModal()" class="text-gray-400 hover:text-gray-600">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <div class="mb-6">
          <div class="flex items-baseline space-x-2 mb-2">
            <span class="text-3xl font-mono font-semibold" id="modal-current-price">$0.00</span>
            <span class="text-sm font-medium" id="modal-price-change">+0.00%</span>
          </div>
          <p class="text-sm text-gray-500">Current Price</p>
        </div>

        <!-- Chart Container -->
        <div class="mb-6 bg-gray-50 rounded-lg p-4">
          <canvas id="modal-chart" height="200"></canvas>
        </div>

        <!-- Trade Form -->
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Quantity</label>
            <input type="number" id="trade-quantity" min="1" value="1"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
              oninput="updateTradeTotal()">
          </div>

          <div class="bg-gray-50 rounded-lg p-4">
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm text-gray-600">Total Cost:</span>
              <span class="text-xl font-mono font-semibold" id="trade-total">$0.00</span>
            </div>
            <div class="flex justify-between items-center text-sm">
              <span class="text-gray-600">Available Cash:</span>
              <span class="font-mono" id="modal-available-cash">$0.00</span>
            </div>
            <div id="holdings-info" class="hidden mt-2 pt-2 border-t border-gray-200">
              <div class="flex justify-between items-center text-sm">
                <span class="text-gray-600">You Own:</span>
                <span class="font-mono" id="modal-holdings">0 plants</span>
              </div>
              <div class="flex justify-between items-center text-sm">
                <span class="text-gray-600">Cost Basis:</span>
                <span class="font-mono" id="modal-holdings-basis">$0.00</span>
              </div>
            </div>
            <div id="short-info" class="hidden mt-2 pt-2 border-t border-gray-200">
              <div class="flex justify-between items-center text-sm">
                <span class="text-gray-600">Borrowed:</span>
                <span class="font-mono" id="modal-short-qty">0 plants</span>
              </div>
              <div class="flex justify-between items-center text-sm">
                <span class="text-gray-600">Borrow Basis:</span>
                <span class="font-mono" id="modal-short-basis">$0.00</span>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <button onclick="executeBuy()" class="w-full bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors">
              Buy Plants
            </button>
            <button onclick="executeSell()" id="sell-button" class="w-full bg-red-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-700 transition-colors">
              Sell Plants
            </button>
            <button onclick="executeShort()" class="w-full bg-yellow-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-yellow-600 transition-colors">
              Borrow & Short
            </button>
            <button onclick="executeCover()" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
              Cover Short
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="hidden fixed bottom-4 right-4 bg-white rounded-lg shadow-lg border border-gray-200 p-4 max-w-sm z-50">
    <p id="toast-message" class="text-sm"></p>
  </div>

  <!-- Event Popups -->
  <div id="event-stack" class="fixed top-24 right-4 space-y-3 max-w-sm z-40 pointer-events-none"></div>

  <script>
    window.API_BASE = localStorage.getItem('FF_API_BASE') || 'http://localhost:8000';
  </script>
  <script src="./app.js"></script>
</body>
</html>






